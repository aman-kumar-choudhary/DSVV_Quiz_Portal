<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Bank - DSVV Quiz System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; margin: 0; }
        
        .logo-container {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            border-bottom-right-radius: 20px;
        }
        
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #1e40af 0%, #3b82f6 100%);
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            position: fixed;
            top: 80px;
            bottom: 0;
            left: 0;
            overflow-y: auto;
        }
        
        .sidebar.collapsed {
            width: 70px;
        }
        
        .main-content {
            transition: all 0.3s ease;
            width: calc(100% - 250px);
            margin-left: 250px;
            margin-top: 80px;
        }
        
        .main-content.expanded {
            width: calc(100% - 70px);
            margin-left: 70px;
            margin-top: 80px;
        }
        
        .nav-item {
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #93c5fd;
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            border-left: 4px solid #ffffff;
        }
        
        .question-card { transition: all 0.3s ease; border-left: 4px solid #10b981; }
        .question-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .difficulty-badge { font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; }
        .difficulty-beginner { background: #dcfce7; color: #166534; }
        .difficulty-easy { background: #bbf7d0; color: #15803d; }
        .difficulty-intermediate { background: #86efac; color: #15803d; }
        .difficulty-advanced { background: #4ade80; color: #166534; }
        .difficulty-expert { background: #22c55e; color: #14532d; }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                top: 80px;
            }
            
            .sidebar .menu-text {
                display: none;
            }
            
            .main-content {
                width: calc(100% - 70px);
                margin-left: 70px;
                margin-top: 80px;
            }
            
            .sidebar.collapsed {
                width: 0;
                display: none;
            }
            
            .main-content.expanded {
                width: 100%;
                margin-left: 0;
                margin-top: 80px;
            }
            
            #hamburger-toggle {
                display: block;
            }
        }
        
        #hamburger-toggle {
            display: none;
        }
        
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 2000;
            height: 60px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        header .logo-container img {
            height: 70px;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- Header with Logo and Hamburger Menu -->
    <header class="bg-white shadow-md py-4 px-4 flex justify-between items-center fixed top-0 left-0 right-0 z-50 h-20">
        <div class="flex items-center w-full justify-between">
            <!-- Logo in Header -->
            <div class="logo-container flex items-center">
                <img src="/static/images/dsvvlogo.png" alt="DSVV Logo" class="h-24 mr-3" />
            </div>
            <div class="flex items-center space-x-6">
                <!-- Admin Notifications -->
                <div class="relative">
                    <button id="admin-notifications-btn" class="text-gray-600 focus:outline-none relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span id="admin-notification-count" class="notification-badge hidden">0</span>
                    </button>
                    <div id="admin-notifications-dropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg py-2 hidden z-50 max-h-96 overflow-y-auto">
                        <div class="px-4 py-2 border-b border-gray-200">
                            <h3 class="font-semibold text-gray-700">Admin Notifications</h3>
                        </div>
                        <div id="admin-notifications-list" class="p-2">
                            <!-- Notifications will be loaded here -->
                        </div>
                        <div class="px-4 py-2 border-t border-gray-200 text-center">
                            <button id="mark-all-read" class="text-blue-600 text-sm hover:underline">
                                Mark all as read
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Hamburger Menu Button -->
                <button id="hamburger-toggle" class="text-gray-600 focus:outline-none md:hidden">
                    <i class="fas fa-bars text-xl"></i>
                </button>

                <!-- User Profile -->
                <div class="relative">
                    <button id="user-menu-button" class="flex items-center focus:outline-none">
                        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-semibold">
                            A
                        </div>
                        <span class="ml-2 text-gray-700 hidden md:block">admin.computer</span>
                        <i class="fas fa-chevron-down ml-1 text-gray-600 text-xs hidden md:block"></i>
                    </button>
                    <!-- User dropdown -->
                    <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 hidden z-50">
                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-user-circle mr-2"></i>Profile
                        </a>
                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-cog mr-2"></i>Settings
                        </a>
                        <a href="/logout" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Dropdown Menu (hidden by default) -->
    <nav id="dropdown-menu" class="hidden md:hidden bg-gradient-to-b from-blue-800 to-blue-600 text-white shadow-lg mt-20 fixed left-0 right-0 z-40">
        <ul class="space-y-2 px-4 py-4">
            <li class="nav-item">
                <a href="/admin" class="flex items-center p-3 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-tachometer-alt w-6 text-center"></i>
                    <span class="ml-3">Dashboard</span>
                </a>
            </li>
            <li class="nav-item active">
                <a href="/admin/questions/management" class="flex items-center p-3 text-white rounded-lg">
                    <i class="fas fa-book w-6 text-center"></i>
                    <span class="ml-3">Question Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/quizzes" class="flex items-center p-3 text-white rounded-lg">
                    <i class="fas fa-rocket w-6 text-center"></i>
                    <span class="ml-3 menu-text">Quiz Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/leaderboard" class="flex items-center p-3 text-white rounded-lg">
                    <i class="fas fa-trophy w-6 text-center"></i>
                    <span class="ml-3 menu-text">Leaderboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/results" class="flex items-center p-3 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-chart-bar w-6 text-center"></i>
                    <span class="ml-3">Results</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/admin/users" class="flex items-center p-3 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-users w-6 text-center"></i>
                    <span class="ml-3">User Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="flex items-center p-3 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-cog w-6 text-center"></i>
                    <span class="ml-3">Settings</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/logout" class="flex items-center p-3 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-sign-out-alt w-6 text-center"></i>
                    <span class="ml-3">Logout</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Sidebar Navigation -->
    <div class="sidebar h-[calc(100vh-80px)] mt-0">
        <div class="py-6">
            <ul class="space-y-2 px-4">
                <li class="nav-item">
                    <a href="/admin" class="flex items-center p-3 text-white rounded-lg">
                        <i class="fas fa-tachometer-alt w-6 text-center"></i>
                        <span class="ml-3 menu-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="/admin/questions/management" class="flex items-center p-3 text-white rounded-lg">
                        <i class="fas fa-book w-6 text-center"></i>
                        <span class="ml-3 menu-text">Question Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/quizzes" class="flex items-center p-3 text-white rounded-lg">
                        <i class="fas fa-rocket w-6 text-center"></i>
                        <span class="ml-3 menu-text">Quiz Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/leaderboard" class="flex items-center p-3 text-white rounded-lg">
                        <i class="fas fa-trophy w-6 text-center"></i>
                        <span class="ml-3 menu-text">Leaderboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/results" class="flex items-center p-3 text-white rounded-lg">
                        <i class="fas fa-chart-bar w-6 text-center"></i>
                        <span class="ml-3 menu-text">Results</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/users" class="flex items-center p-3 text-white rounded-lg">
                        <i class="fas fa-users w-6 text-center"></i>
                        <span class="ml-3 menu-text">User Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="flex items-center p-3 text-white rounded-lg">
                        <i class="fas fa-cog w-6 text-center"></i>
                        <span class="ml-3 menu-text">Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/logout" class="flex items-center p-3 text-white rounded-lg">
                        <i class="fas fa-sign-out-alt w-6 text-center"></i>
                        <span class="ml-3 menu-text">Logout</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content min-h-[calc(100vh-80px)]">
        <div class="p-6 mt-0">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-database text-green-600 mr-3"></i> Question Bank
                </h1>
                <div class="flex items-center space-x-4">
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                        {{ questions|length }} questions
                    </span>
                    <nav class="flex space-x-2 text-sm text-gray-500">
                        <a href="/admin" class="hover:text-blue-600">Dashboard</a>
                        <span>/</span>
                        <a href="/admin/questions/management" class="hover:text-blue-600">Questions</a>
                        <span>/</span>
                        <span class="text-blue-600">Bank</span>
                    </nav>
                </div>
            </div>

            <!-- Filters -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h2 class="text-lg font-semibold mb-4 text-gray-700">Filter Questions</h2>
                <form method="GET" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty Level</label>
                        <select name="difficulty" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="">All Difficulties</option>
                            <option value="beginner">Beginner</option>
                            <option value="easy">Easy</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tag</label>
                        <select name="tag" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="">All Tags</option>
                            {% for tag in tags %}
                            <option value="{{ tag }}">{{ tag }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                            Apply Filters
                        </button>
                    </div>
                </form>
            </div>

            {% if questions %}
            <div class="grid grid-cols-1 gap-6">
                {% for question in questions %}
                <div class="question-card bg-white rounded-xl shadow-md p-6 mb-4" data-question-id="{{ question.question_id }}">
                    <div class="flex justify-between items-center cursor-pointer question-header" onclick="toggleQuestionDetails(this)">
                        <div class="flex items-center">
                            <h3 class="text-lg font-semibold text-gray-800 mr-3">Question {{ loop.index }}</h3>
                            <div class="flex items-center space-x-3">
                                <span class="difficulty-badge difficulty-{{ question.difficulty }}">
                                    {{ question.difficulty|title }}
                                </span>
                                {% if question.tags and question.tags|length > 0 %}
                                <div class="flex flex-wrap gap-1">
                                    {% for tag in question.tags %}
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
                                        {{ tag }}
                                    </span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <i class="fas fa-chevron-down text-gray-500 transition-transform duration-300"></i>
                    </div>
                    
                    <div class="question-details mt-4 hidden">
                        <div class="flex justify-between items-start mb-4">
                            <div class="text-sm text-gray-500">
                                Approved: {{ question.approved_at.strftime('%Y-%m-%d') if question.approved_at else 'N/A' }}
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Question</label>
                            <textarea class="w-full p-3 border border-gray-300 rounded-lg question-text" rows="2">{{ question.text }}</textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            {% for i in range(4) %}
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Option {{ i+1 }}</label>
                                <input type="text" class="w-full p-2 border border-gray-300 rounded-lg option-{{ i+1 }}" 
                                       value="{{ question.options[i] if question.options and question.options[i] else '' }}">
                            </div>
                            {% endfor %}
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Correct Answer</label>
                            <select class="w-full p-2 border border-gray-300 rounded-lg correct-answer">
                                <option value="">Select correct answer</option>
                                {% for i in range(4) %}
                                <option value="option{{ i+1 }}" {% if question.correct_answer == question.options[i] %}selected{% endif %}>
                                    Option {{ i+1 }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tags</label>
                            <div class="flex flex-wrap gap-2 mb-2">
                                {% for tag in tags %}
                                <span class="tag bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer {% if tag in question.tags %}selected bg-blue-100 text-blue-800{% endif %}" 
                                      data-tag="{{ tag }}">
                                    {{ tag }}
                                </span>
                                {% endfor %}
                            </div>
                            <input type="hidden" class="selected-tags" value="{{ question.tags|tojson if question.tags else '[]' }}">
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty Level</label>
                            <select class="w-full p-2 border border-gray-300 rounded-lg difficulty-level">
                                <option value="beginner" {% if question.difficulty == 'beginner' %}selected{% endif %}>Beginner</option>
                                <option value="easy" {% if question.difficulty == 'easy' %}selected{% endif %}>Easy</option>
                                <option value="intermediate" {% if question.difficulty == 'intermediate' %}selected{% endif %}>Intermediate</option>
                                <option value="advanced" {% if question.difficulty == 'advanced' %}selected{% endif %}>Advanced</option>
                                <option value="expert" {% if question.difficulty == 'expert' %}selected{% endif %}>Expert</option>
                            </select>
                        </div>

                        <div class="flex space-x-3">
                            <button class="update-btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-save mr-2"></i>Update
                            </button>
                            <button class="delete-btn bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-trash mr-2"></i>Delete
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="bg-white rounded-xl shadow-md p-12 text-center">
                <i class="fas fa-database text-gray-400 text-6xl mb-4"></i>
                <h2 class="text-2xl font-semibold text-gray-800 mb-2">No Questions in Bank</h2>
                <p class="text-gray-600 mb-6">Questions will appear here after they are approved.</p>
                <a href="/admin/questions/review" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                    <i class="fas fa-tasks mr-2"></i>Review Pending Questions
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Toggle question details for bank page
        function toggleQuestionDetails(element) {
            const details = element.nextElementSibling;
            const icon = element.querySelector('.fa-chevron-down');
            
            details.classList.toggle('hidden');
            icon.classList.toggle('fa-chevron-down');
            icon.classList.toggle('fa-chevron-up');
        }

        // Collapse all questions by default on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.question-details').forEach(detail => {
                detail.classList.add('hidden');
            });
            
            // Add event listeners for question actions
            document.querySelectorAll('.update-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.stopPropagation(); // Prevent triggering the collapse/expand
                    const questionCard = btn.closest('.question-card');
                    const questionId = questionCard.dataset.questionId;
                    const text = questionCard.querySelector('.question-text').value;
                    const options = [
                        questionCard.querySelector('.option-1').value,
                        questionCard.querySelector('.option-2').value,
                        questionCard.querySelector('.option-3').value,
                        questionCard.querySelector('.option-4').value
                    ];
                    const correctAnswer = questionCard.querySelector('.correct-answer').value;
                    const tags = JSON.parse(questionCard.querySelector('.selected-tags').value || '[]');
                    const difficulty = questionCard.querySelector('.difficulty-level').value;

                    const response = await fetch('/api/questions/bank/update', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            question_id: questionId,
                            action: 'update',
                            text: text,
                            options: options,
                            correct_answer: correctAnswer,
                            tags: tags,
                            difficulty: difficulty
                        })
                    });

                    const data = await response.json();
                    showStatus(data.success ? 'success' : 'error', data.message || data.error);
                });
            });

            // Add event listener for delete button
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.stopPropagation(); // Prevent triggering the collapse/expand
                    const questionCard = btn.closest('.question-card');
                    const questionId = questionCard.dataset.questionId;

                    if (confirm('Are you sure you want to delete this question?')) {
                        const response = await fetch('/api/questions/bank/update', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                question_id: questionId,
                                action: 'delete'
                            })
                        });

                        const data = await response.json();
                        if (data.success) {
                            questionCard.remove();
                            showStatus('success', data.message);
                        } else {
                            showStatus('error', data.error);
                        }
                    }
                });
            });
            
            // Set active navigation item
            const currentPage = window.location.pathname;
            const navItems = document.querySelectorAll(".nav-item");

            navItems.forEach((item) => {
                const link = item.querySelector("a");
                if (link.getAttribute("href") === currentPage) {
                    item.classList.add("active");
                } else {
                    item.classList.remove("active");
                }
            });
            
            // Toggle user dropdown
            document.getElementById("user-menu-button").addEventListener("click", function() {
                document.getElementById("user-dropdown").classList.toggle("hidden");
            });

            // Close dropdown when clicking outside
            document.addEventListener("click", function(event) {
                const userMenu = document.getElementById("user-menu-button");
                const dropdown = document.getElementById("user-dropdown");

                if (!userMenu.contains(event.target) && !dropdown.contains(event.target)) {
                    dropdown.classList.add("hidden");
                }
            });
            
            // Hamburger Menu Toggle
            document.getElementById("hamburger-toggle").addEventListener("click", function() {
                const menu = document.getElementById("dropdown-menu");
                menu.classList.toggle("hidden");
            });

            // Close menu when clicking outside
            document.addEventListener("click", function(event) {
                const toggle = document.getElementById("hamburger-toggle");
                const menu = document.getElementById("dropdown-menu");
                if (!toggle.contains(event.target) && !menu.contains(event.target)) {
                    menu.classList.add("hidden");
                }
            });
            
            document.getElementById("hamburger-toggle").addEventListener("click", function() {
                const sidebar = document.querySelector(".sidebar");
                const mainContent = document.querySelector(".main-content");

                sidebar.classList.toggle("collapsed");
                mainContent.classList.toggle("expanded");
            });
            
            // Admin notifications functionality
            const adminNotificationsBtn = document.getElementById("admin-notifications-btn");
            const adminNotificationsDropdown = document.getElementById("admin-notifications-dropdown");
            const adminNotificationCount = document.getElementById("admin-notification-count");
            const adminNotificationsList = document.getElementById("admin-notifications-list");
            const markAllReadBtn = document.getElementById("mark-all-read");

            function loadAdminNotifications() {
                fetch("/api/admin_notifications")
                    .then((response) => response.json())
                    .then((data) => {
                        const notifications = data.notifications;
                        const unreadCount = notifications.filter((n) => !n.read).length;

                        // Update notification count
                        if (unreadCount > 0) {
                            adminNotificationCount.textContent = unreadCount;
                            adminNotificationCount.classList.remove("hidden");
                        } else {
                            adminNotificationCount.classList.add("hidden");
                        }

                        // Update notifications list
                        if (notifications.length > 0) {
                            adminNotificationsList.innerHTML = notifications
                                .map(
                                    (notification) => `
                                    <div class="p-3 border-b border-gray-100 ${notification.read ? "" : "bg-blue-50"}">
                                        <div class="flex justify-between items-start mb-1">
                                            <span class="text-sm font-medium ${notification.read ? "text-gray-700" : "text-blue-700"}">
                                                ${notification.title}
                                            </span>
                                            <span class="text-xs text-gray-500">
                                                ${new Date(notification.timestamp).toLocaleTimeString()}
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-600">${notification.message}</p>
                                        <div class="text-xs text-gray-400 mt-1">
                                            ${new Date(notification.timestamp).toLocaleDateString()}
                                            ${notification.course ? ` • ${notification.course} Sem ${notification.semester}` : ""}
                                        </div>
                                    </div>
                                `
                                )
                                .join("");
                        } else {
                            adminNotificationsList.innerHTML = `
                                <div class="p-4 text-center text-gray-500">
                                    <i class="fas fa-bell-slash text-2xl mb-2"></i>
                                    <p>No notifications</p>
                                </div>
                            `;
                        }
                    })
                    .catch((error) => {
                        console.error("Error loading notifications:", error);
                    });
            }

            // Load notifications initially
            loadAdminNotifications();

            // Toggle notifications dropdown
            adminNotificationsBtn.addEventListener("click", function(e) {
                e.stopPropagation();
                adminNotificationsDropdown.classList.toggle("hidden");
            });

            // Mark all as read
            markAllReadBtn.addEventListener("click", function() {
                fetch("/api/admin_notifications/read", {
                    method: "POST",
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.success) {
                            loadAdminNotifications();
                        }
                    })
                    .catch((error) => {
                        console.error("Error marking notifications as read:", error);
                    });
            });

            // Close dropdown when clicking outside
            document.addEventListener("click", function(e) {
                if (!adminNotificationsDropdown.contains(e.target) && !adminNotificationsBtn.contains(e.target)) {
                    adminNotificationsDropdown.classList.add("hidden");
                }
            });

            // Poll for new notifications every 30 seconds
            setInterval(loadAdminNotifications, 30000);
        });

        function showStatus(type, message) {
            // Create a status notification element
            const statusDiv = document.createElement('div');
            statusDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-400' : 
                'bg-red-100 text-red-800 border border-red-400'
            }`;
            statusDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(statusDiv);
            
            // Remove after 5 seconds
            setTimeout(() => {
                statusDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>