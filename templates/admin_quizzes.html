<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Management - DSVV Quiz System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .tab-button {
        transition: all 0.3s ease;
      }
      .tab-button.active {
        background: #3b82f6;
        color: white;
      }

      /* Header and sidebar styles to match admin.html */
      .sidebar {
        width: 250px;
        background: linear-gradient(180deg, #1e40af 0%, #3b82f6 100%);
        position: fixed;
        top: 80px;
        bottom: 0;
        left: 0;
        overflow-y: auto;
        transition: all 0.3s ease;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }

      .main-content {
        transition: all 0.3s ease;
        width: calc(100% - 250px);
        margin-left: 250px;
        margin-top: 80px;
      }

      header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 2000;
        height: 80px;
        padding: 10px 20px;
        background-color: #ffffff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .logo-container {
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        border-bottom-right-radius: 20px;
      }

      .nav-item {
        transition: all 0.2s ease;
        border-left: 4px solid transparent;
      }

      .nav-item:hover {
        background: rgba(255, 255, 255, 0.1);
        border-left: 4px solid #93c5fd;
      }

      .nav-item.active {
        background: rgba(255, 255, 255, 0.15);
        border-left: 4px solid #ffffff;
      }

      @media (max-width: 768px) {
        .sidebar {
          width: 70px;
          top: 80px;
        }

        .sidebar .menu-text {
          display: none;
        }

        .main-content {
          width: calc(100% - 70px);
          margin-left: 70px;
          margin-top: 80px;
        }

        .sidebar.collapsed {
          width: 0;
          display: none;
        }

        .main-content.expanded {
          width: 100%;
          margin-left: 0;
          margin-top: 80px;
        }

        #hamburger-toggle {
          display: block;
        }
      }
    </style>
  </head>
  <body class="min-h-screen">
    <!-- Header with Logo and Hamburger Menu -->
    <header
      class="bg-white shadow-md py-4 px-4 flex justify-between items-center fixed top-0 left-0 right-0 z-50 h-20"
    >
      <div class="flex items-center w-full justify-between">
        <!-- Logo in Header -->
        <div class="logo-container flex items-center">
          <img
            src="/static/images/dsvvlogo.png"
            alt="DSVV Logo"
            class="h-24 mr-3"
          />
        </div>
        <div class="flex items-center space-x-6">
          <!-- Notifications and user menu (same as admin.html) -->
          <div class="relative">
            <button
              id="admin-notifications-btn"
              class="text-gray-600 focus:outline-none relative"
            >
              <i class="fas fa-bell text-xl"></i>
              <span
                id="admin-notification-count"
                class="notification-badge hidden"
                >0</span
              >
            </button>
          </div>

          <!-- Hamburger Menu Button -->
          <button
            id="hamburger-toggle"
            class="text-gray-600 focus:outline-none md:hidden"
          >
            <i class="fas fa-bars text-xl"></i>
          </button>

          <!-- User Profile -->
          <div class="relative">
            <button
              id="user-menu-button"
              class="flex items-center focus:outline-none"
            >
              <div
                class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-semibold"
              >
                A
              </div>
              <span class="ml-2 text-gray-700 hidden md:block"
                >admin.computer</span
              >
              <i
                class="fas fa-chevron-down ml-1 text-gray-600 text-xs hidden md:block"
              ></i>
            </button>
            <div
              id="user-dropdown"
              class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 hidden z-50"
            >
              <a
                href="#"
                class="block px-4 py-2 text-gray-700 hover:bg-gray-100"
              >
                <i class="fas fa-user-circle mr-2"></i>Profile
              </a>
              <a
                href="#"
                class="block px-4 py-2 text-gray-700 hover:bg-gray-100"
              >
                <i class="fas fa-cog mr-2"></i>Settings
              </a>
              <a
                href="/logout"
                class="block px-4 py-2 text-gray-700 hover:bg-gray-100"
              >
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Dropdown Menu (hidden by default) -->
    <nav
      id="dropdown-menu"
      class="hidden md:hidden bg-gradient-to-b from-blue-800 to-blue-600 text-white shadow-lg mt-20 fixed left-0 right-0 z-40"
    >
      <ul class="space-y-2 px-4 py-4">
        <li class="nav-item">
          <a
            href="/admin"
            class="flex items-center p-3 rounded-lg hover:bg-blue-700"
          >
            <i class="fas fa-tachometer-alt w-6 text-center"></i>
            <span class="ml-3">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            href="/admin/questions/management"
            class="flex items-center p-3 text-white rounded-lg"
          >
            <i class="fas fa-book w-6 text-center"></i>
            <span class="ml-3 menu-text">Question Management</span>
          </a>
        </li>
        <li class="nav-item active">
          <a
            href="/admin/quizzes"
            class="flex items-center p-3 text-white rounded-lg"
          >
            <i class="fas fa-rocket w-6 text-center"></i>
            <span class="ml-3 menu-text">Quiz Management</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            href="/admin/leaderboard"
            class="flex items-center p-3 text-white rounded-lg"
          >
            <i class="fas fa-trophy w-6 text-center"></i>
            <span class="ml-3 menu-text">Leaderboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            href="/admin/results"
            class="flex items-center p-3 rounded-lg hover:bg-blue-700"
          >
            <i class="fas fa-chart-bar w-6 text-center"></i>
            <span class="ml-3">Results</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            href="/admin/users"
            class="flex items-center p-3 rounded-lg hover:bg-blue-700"
          >
            <i class="fas fa-users w-6 text-center"></i>
            <span class="ml-3">User Management</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            href="#"
            class="flex items-center p-3 rounded-lg hover:bg-blue-700"
          >
            <i class="fas fa-cog w-6 text-center"></i>
            <span class="ml-3">Settings</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            href="/logout"
            class="flex items-center p-3 rounded-lg hover:bg-blue-700"
          >
            <i class="fas fa-sign-out-alt w-6 text-center"></i>
            <span class="ml-3">Logout</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Sidebar Navigation -->
    <div class="sidebar h-[calc(100vh-80px)] mt-0">
      <div class="py-6">
        <ul class="space-y-2 px-4">
          <li class="nav-item">
            <a
              href="/admin"
              class="flex items-center p-3 text-white rounded-lg"
            >
              <i class="fas fa-tachometer-alt w-6 text-center"></i>
              <span class="ml-3 menu-text">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              href="/admin/questions/management"
              class="flex items-center p-3 text-white rounded-lg"
            >
              <i class="fas fa-book w-6 text-center"></i>
              <span class="ml-3 menu-text">Question Management</span>
            </a>
          </li>
          <li class="nav-item active">
            <a
              href="/admin/quizzes"
              class="flex items-center p-3 text-white rounded-lg"
            >
              <i class="fas fa-rocket w-6 text-center"></i>
              <span class="ml-3 menu-text">Quiz Management</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              href="/admin/leaderboard"
              class="flex items-center p-3 text-white rounded-lg"
            >
              <i class="fas fa-trophy w-6 text-center"></i>
              <span class="ml-3 menu-text">Leaderboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              href="/admin/results"
              class="flex items-center p-3 text-white rounded-lg"
            >
              <i class="fas fa-chart-bar w-6 text-center"></i>
              <span class="ml-3 menu-text">Results</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              href="/admin/users"
              class="flex items-center p-3 text-white rounded-lg"
            >
              <i class="fas fa-users w-6 text-center"></i>
              <span class="ml-3 menu-text">User Management</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="flex items-center p-3 text-white rounded-lg">
              <i class="fas fa-cog w-6 text-center"></i>
              <span class="ml-3 menu-text">Settings</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              href="/logout"
              class="flex items-center p-3 text-white rounded-lg"
            >
              <i class="fas fa-sign-out-alt w-6 text-center"></i>
              <span class="ml-3 menu-text">Logout</span>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content p-6">
      <div class="max-w-6xl mx-auto">
        <div class="mb-6">
          <h1 class="text-3xl font-bold text-gray-800">Quiz Management</h1>
          <p class="text-gray-600">
            Create and manage quizzes for different courses
          </p>
        </div>

        <!-- Create New Quiz Button -->
        <div class="mb-6">
          <button
            id="create-quiz-btn"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
          >
            <i class="fas fa-plus-circle mr-2"></i>Create New Quiz
          </button>
        </div>

        <!-- Create Quiz Modal -->
        <div
          id="create-quiz-modal"
          class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
        >
          <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
              Create New Quiz
            </h2>
            <form id="create-quiz-form" class="space-y-4">
              <div>
                <label
                  for="quiz-title"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Quiz Title</label
                >
                <input
                  type="text"
                  id="quiz-title"
                  name="quiz_title"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Enter quiz title"
                  required
                />
              </div>

              <div>
                <label
                  for="quiz-school"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >School</label
                >
                <select
                  id="quiz-school"
                  name="school"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  required
                >
                  <option value="">Select School</option>
                  <option
                    value="School of Technology, Communication and Management"
                  >
                    School of Technology, Communication and Management
                  </option>
                  <option
                    value="School of Biological Sciences and Sustainability"
                  >
                    School of Biological Sciences and Sustainability
                  </option>
                  <option value="School of Indology">School of Indology</option>
                  <option
                    value="School of Humanities, Social Sciences and Foundation Courses"
                  >
                    School of Humanities, Social Sciences and Foundation Courses
                  </option>
                </select>
              </div>

              <div>
                <label
                  for="quiz-department"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Department</label
                >
                <select
                  id="quiz-department"
                  name="department"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  required
                >
                  <option value="">Select Department</option>
                  <!-- Departments will be populated based on school selection -->
                </select>
              </div>

              <div>
                <label
                  for="quiz-course"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Course</label
                >
                <select
                  id="quiz-course"
                  name="course"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  required
                >
                  <option value="">Select Course</option>
                  <!-- Courses will be populated based on department selection -->
                </select>
              </div>

              <div>
                <label
                  for="quiz-semester"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Semester</label
                >
                <select
                  id="quiz-semester"
                  name="semester"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  required
                >
                  <option value="">Select Semester</option>
                  <option value="1">Semester 1</option>
                  <option value="2">Semester 2</option>
                  <option value="3">Semester 3</option>
                  <option value="4">Semester 4</option>
                  <option value="5">Semester 5</option>
                  <option value="6">Semester 6</option>
                </select>
              </div>

              <div>
                <label
                  for="quiz-duration"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Duration (minutes)</label
                >
                <input
                  type="number"
                  id="quiz-duration"
                  name="duration"
                  min="1"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Enter duration"
                  required
                />
              </div>

              <div>
                <label
                  for="quiz-pass-percentage"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Pass Percentage</label
                >
                <input
                  type="number"
                  id="quiz-pass-percentage"
                  name="pass_percentage"
                  min="1"
                  max="100"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Enter pass percentage"
                  required
                />
              </div>

              <div class="flex justify-end space-x-3 pt-4">
                <button
                  type="button"
                  id="cancel-quiz-btn"
                  class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                >
                  Create
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Quizzes List -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">
            Active Quizzes
          </h2>

          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead>
                <tr>
                  <th
                    class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Quiz Title
                  </th>
                  <th
                    class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Course
                  </th>
                  <th
                    class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Semester
                  </th>
                  <th
                    class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Duration
                  </th>
                  <th
                    class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Status
                  </th>
                  <th
                    class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody
                id="quizzes-table-body"
                class="bg-white divide-y divide-gray-200"
              >
                <!-- Quizzes will be populated here via JavaScript -->
              </tbody>
            </table>
          </div>

          <div
            id="no-quizzes-message"
            class="text-center text-gray-500 py-6 hidden"
          >
            No quizzes found. Create your first quiz!
          </div>
        </div>
      </div>
    </div>

    <!-- Success/Error Toast -->
    <div
      id="toast"
      class="fixed top-4 right-4 p-4 rounded-lg shadow-lg bg-white border-l-4 border-green-500 transform translate-x-full transition-transform duration-300 z-50 max-w-sm"
    >
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <i class="fas fa-check-circle text-green-500"></i>
        </div>
        <div class="ml-3">
          <p id="toast-message" class="text-sm font-medium text-gray-800">
            Success!
          </p>
          <p id="toast-description" class="mt-1 text-sm text-gray-600">
            Operation completed successfully.
          </p>
        </div>
        <button
          class="ml-4 flex-shrink-0 focus:outline-none"
          onclick="hideToast()"
        >
          <i class="fas fa-times text-gray-400"></i>
        </button>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div
      id="loading-overlay"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white rounded-lg p-6 flex items-center">
        <div
          class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4 border-t-blue-500 animate-spin"
        ></div>
        <p class="ml-4 text-gray-800">Processing, please wait...</p>
      </div>
    </div>

    <script>
      // School, department, and course data
      const schoolDepartments = {
        "School of Technology, Communication and Management": [
          "Department of Computer Sciences",
          "Department of Tourism Management",
          "Department of Journalism & Mass Communication",
          "Department of Animation and Visual Effects",
        ],
        "School of Biological Sciences and Sustainability": [
          "Department of Rural Studies and Sustainability",
        ],
        "School of Indology": [
          "Department of Sanskrit and Vedic Studies",
          "Department of Hindi",
          "Department of Indian Classical Music",
          "Department of History and Indian Culture",
        ],
        "School of Humanities, Social Sciences and Foundation Courses": [
          "Department of English",
          "Department of Education",
          "Department of Psychology",
          "Department of Life Management",
          "Department of Scientific Spirituality",
          "Department of Oriental Studies, Religious Studies & Philosophy",
          "Department of Yogic Sciences and Human Consciousness",
        ],
      };

      const departmentCourses = {
        "Department of Computer Sciences": [
          "B.Sc. Information Technology (Honors)",
          "Bachelor of Computer Application (Honors)",
          "Master of Computer Application (Data Science)",
        ],
        "Department of Tourism Management": [
          "B.B.A Tourism & Travel Management (Honors)",
          "M.B.A. Tourism & Travel Management",
        ],
        "Department of Journalism & Mass Communication": [
          "B.A. Journalism and Mass Communication (Honors)",
          "M. A. Journalism and Mass Communication",
          "M. A. Spiritual Journalism",
        ],
        "Department of Animation and Visual Effects": [
          "B.Voc. (Bachelor of Vocation) in 3D Animation and VFX (Honors)",
        ],
        "Department of Rural Studies and Sustainability": [
          "Bachelor of Rural Studies (Honors)",
        ],
        "Department of English": ["B.A. English (Honors)"],
        "Department of Education": ["B.Ed. (Bachelor of Education)"],
        "Department of Psychology": [
          "B.A. Psychology (Honors)",
          "M.A. Counselling Psychology",
          "M.Sc. Counselling Psychology",
        ],
        "Department of Life Management": [
          "Life Management - Compulsory Program for PG and UG",
        ],
        "Department of Scientific Spirituality": [
          "M.Sc. Herbal Medicine and Natural Product Chemistry",
          "M.Sc. Molecular Physiology and Traditional Health Sciences",
          "M.Sc. Indigenous Approaches for Child Development & Generational Dynamics",
          "M.Sc. Indian Knowledge Systems",
          "M.A. Indian Knowledge Systems",
        ],
        "Department of Oriental Studies, Religious Studies & Philosophy": [
          "M.A. Hindu Studies",
          "M.A. Philosophy",
        ],
        "Department of Yogic Sciences and Human Consciousness": [
          "B.Sc. Yogic Science (Honors)",
          "M.Sc. Yoga Therapy",
          "M.A. Human Consciousness & Yogic Science",
          "M.Sc. Human Consciousness & Yogic Science",
          "P. G. Diploma Human Consciousness, Yoga & Alternative Therapy",
          "Certificate In Yoga And Alternative Therapy",
        ],
        "Department of Sanskrit and Vedic Studies": [
          "B.A. Sanskrit (Honors)",
          "M.A. Sanskrit",
        ],
        "Department of Hindi": ["B.A. Hindi (Honors)", "M.A. Hindi"],
        "Department of Indian Classical Music": [
          "B.A. Music (Vocal) (Honors)",
          "M.A. Music (Vocal)",
          "B.A. Music Instrumental Mridang/Tabla (Honors)",
          "M.A. Music (Tabla, Pakhaawaj)",
        ],
        "Department of History and Indian Culture": [
          "B.A. History (Honors)",
          "M. A. History and Indian Culture",
        ],
      };

      // Create quiz modal functionality
      document
        .getElementById("create-quiz-btn")
        .addEventListener("click", function () {
          document
            .getElementById("create-quiz-modal")
            .classList.remove("hidden");
        });

      document
        .getElementById("cancel-quiz-btn")
        .addEventListener("click", function () {
          document.getElementById("create-quiz-modal").classList.add("hidden");
          document.getElementById("create-quiz-form").reset();
        });

      // School selection change handler
      // School selection change handler
      document
        .getElementById("quiz-school")
        .addEventListener("change", function () {
          const school = this.value;
          const departmentSelect = document.getElementById("quiz-department");

          // Clear previous options
          departmentSelect.innerHTML =
            '<option value="">Select Department</option>';
          departmentSelect.innerHTML +=
            '<option value="all">All Departments</option>';

          if (school && school !== "all" && schoolDepartments[school]) {
            // Add departments for selected school
            schoolDepartments[school].forEach((department) => {
              const option = document.createElement("option");
              option.value = department;
              option.textContent = department;
              departmentSelect.appendChild(option);
            });
          }
        });

      // Department selection change handler

      document
        .getElementById("quiz-department")
        .addEventListener("change", function () {
          const department = this.value;
          const courseSelect = document.getElementById("quiz-course");

          courseSelect.innerHTML = '<option value="">Select Course</option>';
          courseSelect.innerHTML += '<option value="all">All Courses</option>';

          if (
            department &&
            department !== "all" &&
            departmentCourses[department]
          ) {
            departmentCourses[department].forEach((course) => {
              const option = document.createElement("option");
              option.value = course;
              option.textContent = course;
              courseSelect.appendChild(option);
            });
          }
        });
      // Update the school options to include "all"
      document.getElementById("quiz-school").innerHTML = `
    <option value="">Select School</option>
    <option value="all">All Schools</option>
    <option value="School of Technology, Communication and Management">School of Technology, Communication and Management</option>
    <option value="School of Biological Sciences and Sustainability">School of Biological Sciences and Sustainability</option>
    <option value="School of Indology">School of Indology</option>
    <option value="School of Humanities, Social Sciences and Foundation Courses">School of Humanities, Social Sciences and Foundation Courses</option>
`;

      // Update the semester options to include "all"
      document.getElementById("quiz-semester").innerHTML = `
    <option value="">Select Semester</option>
    <option value="all">All Semesters</option>
    <option value="1">Semester 1</option>
    <option value="2">Semester 2</option>
    <option value="3">Semester 3</option>
    <option value="4">Semester 4</option>
    <option value="5">Semester 5</option>
    <option value="6">Semester 6</option>
    <option value="7">Semester 7</option>
    <option value="8">Semester 8</option>
`;

      // Create quiz form submission
      document
        .getElementById("create-quiz-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const quizData = Object.fromEntries(formData.entries());

          showLoading();

          fetch("/admin/quizzes/create", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(quizData),
          })
            .then((response) => response.json())
            .then((data) => {
              hideLoading();
              if (data.success) {
                showToast("Success", "Quiz created successfully", "success");
                document
                  .getElementById("create-quiz-modal")
                  .classList.add("hidden");
                document.getElementById("create-quiz-form").reset();
                loadQuizzes();
              } else {
                showToast(
                  "Error",
                  data.error || "Failed to create quiz",
                  "error"
                );
              }
            })
            .catch((error) => {
              hideLoading();
              showToast("Error", "Failed to create quiz: " + error, "error");
            });
        });

      function loadQuizzes() {
        showLoading();

        fetch("/admin/quizzes/list")
          .then((response) => response.json())
          .then((data) => {
            hideLoading();
            const tableBody = document.getElementById("quizzes-table-body");
            const noQuizzesMessage =
              document.getElementById("no-quizzes-message");

            tableBody.innerHTML = "";

            if (data.quizzes && data.quizzes.length > 0) {
              noQuizzesMessage.classList.add("hidden");

              data.quizzes.forEach((quiz) => {
                const row = document.createElement("tr");

                // Format status badge
                let statusClass, statusText;
                if (quiz.status === "active") {
                  // Changed from quiz.active to quiz.status
                  statusClass = "bg-green-100 text-green-800";
                  statusText = "Active";
                } else if (quiz.status === "draft") {
                  statusClass = "bg-yellow-100 text-yellow-800";
                  statusText = "Draft";
                } else {
                  statusClass = "bg-gray-100 text-gray-800";
                  statusText = "Inactive";
                }

                row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${quiz.title}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${quiz.course}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${quiz.semester}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${quiz.duration} minutes</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold ${statusClass} rounded-full">${statusText}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <a href="/admin/quizzes/manage/${quiz.quiz_id}" class="text-blue-600 hover:text-blue-900 mr-3">Manage</a>
                            <button onclick="deleteQuiz('${quiz.quiz_id}')" class="text-red-600 hover:text-red-900">Delete</button>
                        </td>
                    `;

                tableBody.appendChild(row);
              });
            } else {
              noQuizzesMessage.classList.remove("hidden");
            }
          })
          .catch((error) => {
            hideLoading();
            showToast("Error", "Failed to load quizzes: " + error, "error");
          });
      }

      // Edit quiz
      function editQuiz(quizId) {
        showToast(
          "Info",
          "Edit functionality will be implemented soon",
          "info"
        );
      }

      // Delete quiz
      // Delete quiz function
      async function deleteQuiz(quizId) {
        if (confirm("Are you sure you want to delete this quiz?")) {
          showLoading();

          try {
            const response = await fetch(`/api/quizzes/${quizId}`, {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
              },
            });

            // Check if response is JSON
            const contentType = response.headers.get("content-type");
            if (contentType && contentType.includes("application/json")) {
              const data = await response.json();
              if (data.success) {
                showToast("Success", "Quiz deleted successfully", "success");
                loadQuizzes();
              } else {
                showToast(
                  "Error",
                  data.error || "Failed to delete quiz",
                  "error"
                );
              }
            } else {
              // Handle non-JSON response (likely an error page)
              const text = await response.text();
              console.error("Non-JSON response:", text);
              showToast(
                "Error",
                "Server error: Received HTML instead of JSON",
                "error"
              );
            }
          } catch (error) {
            hideLoading();
            showToast(
              "Error",
              "Failed to delete quiz: " + error.message,
              "error"
            );
          }
        }
      }

      // Toast notification functions
      function showToast(title, message, type = "success") {
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toast-message");
        const toastDescription = document.getElementById("toast-description");

        // Set border color based on type
        toast.className = toast.className.replace(
          /border-(red|green|yellow|blue)-500/,
          ""
        );
        toast.classList.add(
          `border-${
            type === "success"
              ? "green"
              : type === "error"
              ? "red"
              : type === "warning"
              ? "yellow"
              : "blue"
          }-500`
        );

        // Set icon based on type
        const iconElement = toast.querySelector(".flex-shrink-0 i");
        iconElement.className =
          type === "success"
            ? "fas fa-check-circle text-green-500"
            : type === "error"
            ? "fas fa-exclamation-circle text-red-500"
            : type === "warning"
            ? "fas fa-exclamation-triangle text-yellow-500"
            : "fas fa-info-circle text-blue-500";

        toastMessage.textContent = title;
        toastDescription.textContent = message;

        // Show toast
        toast.classList.remove("translate-x-full");

        // Auto hide after 5 seconds
        setTimeout(hideToast, 5000);
      }

      function hideToast() {
        const toast = document.getElementById("toast");
        toast.classList.add("translate-x-full");
      }

      // Loading overlay functions
      function showLoading() {
        document.getElementById("loading-overlay").classList.remove("hidden");
      }

      function hideLoading() {
        document.getElementById("loading-overlay").classList.add("hidden");
      }

      // Mobile menu toggle
      document
        .getElementById("hamburger-toggle")
        .addEventListener("click", function () {
          const dropdownMenu = document.getElementById("dropdown-menu");
          dropdownMenu.classList.toggle("hidden");
        });

      // User dropdown toggle
      document
        .getElementById("user-menu-button")
        .addEventListener("click", function () {
          const userDropdown = document.getElementById("user-dropdown");
          userDropdown.classList.toggle("hidden");
        });

      // Close dropdowns when clicking outside
      document.addEventListener("click", function (event) {
        const userMenuButton = document.getElementById("user-menu-button");
        const userDropdown = document.getElementById("user-dropdown");

        if (
          !userMenuButton.contains(event.target) &&
          !userDropdown.contains(event.target)
        ) {
          userDropdown.classList.add("hidden");
        }

        const hamburgerToggle = document.getElementById("hamburger-toggle");
        const dropdownMenu = document.getElementById("dropdown-menu");

        if (
          !hamburgerToggle.contains(event.target) &&
          !dropdownMenu.contains(event.target)
        ) {
          dropdownMenu.classList.add("hidden");
        }
      });

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        loadQuizzes();
      });
    </script>
  </body>
</html>
