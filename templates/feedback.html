<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Feedback - DSVV Quiz System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
      .rating-star {
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .rating-star:hover,
      .rating-star.active {
        color: #f59e0b;
        transform: scale(1.2);
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
    <div class="container mx-auto px-4">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-blue-800 mb-4">Quiz Feedback</h1>
        <p class="text-lg text-gray-700">
          We value your feedback to improve our quiz system
        </p>
      </div>

      <!-- Feedback Form -->
      <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg">
        {% if error %}
        <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-r-lg">
          <div class="flex">
            <div class="flex-shrink-0">
              <i class="fas fa-exclamation-circle text-red-500"></i>
            </div>
            <div class="ml-3">
              <p class="text-sm text-red-700">{{ error }}</p>
            </div>
          </div>
        </div>
        {% endif %}

        <form method="POST" class="space-y-6">
          <!-- Rating Section -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-4"
              >How would you rate your quiz experience?</label
            >
            <div class="flex justify-center space-x-2 mb-2">
              {% for i in range(1, 6) %}
              <div class="rating-item">
                <input type="radio" id="rating-{{ i }}" name="rating" value="{{
                i }}" class="hidden" {% if i == 5 %}checked{% endif %}>
                <label
                  for="rating-{{ i }}"
                  class="rating-star text-3xl text-gray-300 cursor-pointer transition-all"
                >
                  <i class="fas fa-star"></i>
                </label>
              </div>
              {% endfor %}
            </div>
            <div class="flex justify-between text-xs text-gray-500">
              <span>Poor</span>
              <span>Excellent</span>
            </div>
          </div>

          <!-- Feedback Text -->
          <div>
            <label
              for="feedback_text"
              class="block text-sm font-medium text-gray-700 mb-2"
              >Your Feedback (Optional)</label
            >
            <textarea
              id="feedback_text"
              name="feedback_text"
              rows="4"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"
              placeholder="What did you like about the quiz? Any suggestions for improvement?"
            ></textarea>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-col sm:flex-row gap-4 justify-center pt-4">
            <button
              type="submit"
              class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg text-lg font-medium transition-all duration-300 flex items-center justify-center"
            >
              <i class="fas fa-paper-plane mr-2"></i> Submit Feedback
            </button>
            <a
              href="{{ url_for('view_score') }}"
              class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg text-lg font-medium transition-all duration-300 text-center flex items-center justify-center"
            >
              <i class="fas fa-chart-bar mr-2"></i> View Results First
            </a>
          </div>
        </form>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const ratingStars = document.querySelectorAll(".rating-star");
        const ratingInputs = document.querySelectorAll('input[name="rating"]');

        // Initialize rating display
        function updateRatingDisplay() {
          ratingStars.forEach((star, index) => {
            const input = ratingInputs[index];
            if (input.checked) {
              // Make this star and all previous stars active
              for (let i = 0; i <= index; i++) {
                ratingStars[i].classList.add("active");
                ratingStars[i].classList.remove("text-gray-300");
                ratingStars[i].classList.add("text-yellow-400");
              }
              // Make subsequent stars inactive
              for (let i = index + 1; i < ratingStars.length; i++) {
                ratingStars[i].classList.remove("active");
                ratingStars[i].classList.add("text-gray-300");
                ratingStars[i].classList.remove("text-yellow-400");
              }
            }
          });
        }

        // Set up click handlers for stars
        ratingStars.forEach((star, index) => {
          star.addEventListener("click", function () {
            ratingInputs[index].checked = true;
            updateRatingDisplay();
          });
        });

        // Set up change handlers for radio inputs
        ratingInputs.forEach((input) => {
          input.addEventListener("change", updateRatingDisplay);
        });

        // Initialize the rating display
        updateRatingDisplay();
      });
      // Prevent back-forward cache
      window.onpageshow = function (event) {
        if (event.persisted) {
          window.location.reload();
        }
      };

      // Clear session storage on page unload
      window.onbeforeunload = function () {
        sessionStorage.removeItem("reload");
      };

      // Check if page was restored from bfcache
      if (performance.navigation.type === 2) {
        // Page was restored from back/forward cache
        window.location.reload();
      }
    </script>
  </body>
</html>
